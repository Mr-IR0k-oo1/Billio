<!DOCTYPE html>
<html>
<head>
    <title>Plasma Test</title>
    <style>
        body { margin: 0; overflow: hidden; }
        #container { width: 100vw; height: 100vh; position: relative; }
        #fallback { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: linear-gradient(45deg, #ff0000, #00ff00); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-size: 24px;
            z-index: 1;
        }
        #plasma { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; }
    </style>
</head>
<body>
    <div id="container">
        <div id="fallback">If you see this, WebGL is not working</div>
        <canvas id="plasma"></canvas>
    </div>

    <script type="module">
        import { Renderer, Program, Mesh, Triangle } from 'https://cdn.skypack.dev/ogl';

        try {
            const renderer = new Renderer({
                webgl: 2,
                alpha: true,
                antialias: false
            });
            
            const gl = renderer.gl;
            console.log('WebGL context:', gl);
            
            const canvas = gl.canvas;
            const container = document.getElementById('container');
            const fallback = document.getElementById('fallback');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            container.appendChild(canvas);
            
            // Hide fallback if WebGL works
            fallback.style.display = 'none';
            
            const vertex = `#version 300 es
                precision highp float;
                in vec2 position;
                void main() {
                    gl_Position = vec4(position, 0.0, 1.0);
                }
            `;

            const fragment = `#version 300 es
                precision highp float;
                out vec4 fragColor;
                uniform float iTime;
                uniform vec2 iResolution;
                void main() {
                    vec2 uv = gl_FragCoord.xy / iResolution.xy;
                    vec3 color = vec3(
                        sin(iTime + uv.x * 10.0) * 0.5 + 0.5,
                        cos(iTime * 1.3 + uv.y * 10.0) * 0.5 + 0.5,
                        sin(iTime * 0.7 + length(uv - 0.5) * 10.0) * 0.5 + 0.5
                    );
                    fragColor = vec4(color, 1.0);
                }
            `;

            const geometry = new Triangle(gl);
            const program = new Program(gl, {
                vertex,
                fragment,
                uniforms: {
                    iTime: { value: 0 },
                    iResolution: { value: [window.innerWidth, window.innerHeight] }
                }
            });

            const mesh = new Mesh(gl, { geometry, program });

            const t0 = performance.now();
            function render(t) {
                const timeValue = (t - t0) * 0.001;
                program.uniforms.iTime.value = timeValue;
                renderer.render({ scene: mesh });
                requestAnimationFrame(render);
            }
            render(0);

            console.log('Plasma effect started successfully!');

        } catch (error) {
            console.error('WebGL/Plasma failed:', error);
            document.getElementById('fallback').innerHTML = 'WebGL Error: ' + error.message;
        }
    </script>
</body>
</html>